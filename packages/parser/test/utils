/*!
 * Copyright (c) Aaron Delasy
 * Licensed under the MIT License
 */

import EXPECT_EQ from "the/testing"
import parse from "../src/parser"
import * as t from "../src/types"

export fn EXPECT_FALSE (a: bool) {
  EXPECT_EQ(a, false)
}

export fn EXPECT_TRUE (a: bool) {
  EXPECT_EQ(a, true)
}

export fn EXPECT_NO_THROW (function: () -> void) bool {
  mut message: str

  try {
    function()
  } catch err: error_Error {
    message = err.message
  }

  EXPECT_EQ(message, "")
}

export fn EXPECT_THROW_WITH_MESSAGE (function: () -> void, message: str) bool {
  mut errMessage: str

  try {
    function()
  } catch err: error_Error {
    errMessage = err.message
  }

  EXPECT_EQ(errMessage, message)
}

export fn parseExpression (code: str) t.Expression {
  f := parse(code)
  statement := f.program.body[0].asExpression()
  return statement.expression
}

export fn parseStatement (code: str) t.Statement {
  f := parse(code)
  return f.program.body[0]
}

export fn parseType (code: str) t.Type {
  f := parse("var: " + code)
  statement := f.program.body[0].asVariableDeclaration()
  return statement.t as t.Type
}
